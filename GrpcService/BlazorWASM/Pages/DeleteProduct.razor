@page "/DeleteProduct"
@using HttpClients.ClientInterfaces
@using global::Shared.Models
@inject IWarehouseService WarehouseService;

@attribute [Authorize("mustbeadmin")]
<h3>DeleteProduct</h3>
@foreach (Product product in products)
{
  <div class="card" style="width: 18rem">
    <img class="card-img-top" src="Images/Boremaskine.jpg" alt="Card image cap">
    <div class="card-body">
      <h5 class="card-title">@product</h5>
      <ul class="list-group list-group-flush">
        <li class="list-group-item">Antal på lager: @amount </li>
        <li class="list-group-item">EAN: @EAN </li>
        <li class="list-group-item">Lokation: @Location</li>
      </ul>
      <a href="#" class="btn btn-primary"  @onclick="@(() => DeleteAndRefresh(product))"> Refresh >Delete Product</a>
    </div>
  </div>
}

@code {
  private List<Product> products;

  private int amount;
  private string EAN;
  private string Location;
  private string resultMsg = "";
  
  private string color = "";
    
  private async Task Delete(Product product)
  {
    resultMsg = "";

    try
    {
      await WarehouseService.DeleteAsync(product);
    }
    catch (Exception e)
    {
      Console.WriteLine(e);
      resultMsg = e.Message;
      color = "red";
    }
  }
  protected override async Task OnInitializedAsync() {
    try
    {
      products = await WarehouseService.RetrieveAsync();
    }
    catch (Exception e) {
      Console.WriteLine(e);
      resultMsg = e.Message;
    }
  }
  private async Task PopulateProducts()
  {
    resultMsg = "";
    try
    {
      products = await WarehouseService.RetrieveAsync();
    }
    catch (Exception e)
    {
      Console.WriteLine(e);
      resultMsg = e.Message;
      color = "red";
    }
  }

  private async Task DeleteAndRefresh(Product product)
  {

    try
    {
      await Delete(product);
      products = await WarehouseService.RetrieveAsync();
           
    }
    catch (Exception e)
    {
      Console.WriteLine(e);
      resultMsg = e.Message;
    }
  }
}